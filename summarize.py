import os

summaryPrePart = """---
sidebar_position: 1
id: practise-coding-record
title: Docs Summary
tags: [intro]
---

> æœ¬æ–‡ä¸»è¦æ€»ç»“æœ¬äººæ‰€è¾“å‡ºçš„æŠ€æœ¯æ–‡ç« ã€‚

## ä½œå“é›† Portfolio

- æˆ‘ç”¨ä¸€å‘¨æ—¶é—´å¼€å‘äº†ä¸€ä¸ª ðŸ‡¸ðŸ‡¬ æ–°åŠ å¡ pr ç”³è¯·æŸ¥è¯¢çš„åº”ç”¨ https://sgpass.info/
  - å°çº¢ä¹¦å®£ä¼ å¸–å­ï¼š [link](http://xhslink.com/0p7H7Q)
  - è‡ªå·±ä¸€ä¸ªäºº solo çš„é¡¹ç›®
    1. åŸºäºŽ Nextjs æ­å»ºå‰åŽç«¯
    2. é›†æˆ Clerk çš„ç”¨æˆ·é‰´æƒ
    3. ä½¿ç”¨ Supabase çš„ Postgres æ•°æ®åº“ï¼Œç›®å‰è¿˜æ˜¯å…è´¹ç‰ˆæœ¬
    4. éƒ¨ç½²åœ¨ Vercel ä¸Šï¼Œè‡ªå¸¦ç®€æ˜“çš„æœåŠ¡ç›‘æŽ§ï¼Œå¼€äº†ä¼šå‘˜ 30 ç¾Žåˆ€ä¸€ä¸ªæœˆ
    5. åœ¨ Domaincheap ä¹°åŸŸåï¼Œ3ç¾Žåˆ€ä¸€å¹´
    6. ä½¿ç”¨ Chatgpt API åˆ†æž 500 æ¡è®°å½•ï¼Œ6ç¾Žåˆ€
  - æŒç»­æ›´æ–°ä¸­

"""

afterPart = """
> Auto generated by summarize.py
> æŽ’ç‰ˆå‚è€ƒ [ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ç³»åˆ—æ–‡ç« ](https://draveness.me/whys-the-design/)
"""

additions = """
- 063 [ã€Slideã€‘æˆ‘åœ¨ç»„å†…åšäº†ä¸€æ¬¡æŠ€æœ¯åˆ†äº«ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒI did a Distributed Systems Sharing in our Team](https://docs.google.com/presentation/d/1WhaGyZQZUH905QXI5QKHfKzojU1wFxcuWiNiF2pq994)
- 062 [æˆ‘åœ¨ NUS çš„åˆ†å¸ƒå¼ç³»ç»Ÿè¯¾ç»“è¯¾æ»¡åˆ†ï¼ŒI got 100 in NUS CS5223](https://doc.fenglyulin.com/docs/distributed-systems/milestone)
- 061 [ã€è§†é¢‘ã€‘43ç§’å¸¦ä½ é€Ÿé€šåˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚å¿µ [Video] A quick tour of Distributed System](https://doc.fenglyulin.com/docs/distributed-systems/overview) 
- 060 [è®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡åž‹é¢„æµ‹èµ¢å®¶ï¼Œåœ¨ Kaggle å‡†ç¡®åº¦æœ€é«˜ Game Winner Prediction, best 76.9% w EDA&Finetune](https://www.kaggle.com/code/kirklin/game-winner-prediction-best-76-9-w-eda-finetune)
"""

class SFile:
    def __init__(self, path, filename, ctime, is_additional_file=False):
        self.path = path
        self.filename = filename
        self.ctime = ctime
        self.is_additional_file = is_additional_file
    
def gather_markdown_files(folder_path):
    idx = 0
    for root, dirs, files in os.walk(folder_path):
        print("idx:", idx)
        print("Root:", root)
        for dir in dirs:
            print("Directory:", dir)
        for file in files:
            print("File:", file)
        break
    return None


def getDirs2(folder_path):
    dirs = []
    for root, dirs, files in os.walk(folder_path):
        dirs.append(dirs)
        for dir in dirs:
            full_path = os.path.join(root, dir)
            print("full_path:", full_path)
            print("ctime", os.path.getctime(full_path))
            print("ctime_int", int(os.path.getctime(full_path)))
            print("size", os.path.getsize(full_path))
            print("isfile", os.path.isfile(full_path))
            print("isdir", os.path.isdir(full_path))
            print("stat", os.stat(full_path))
            stat = os.stat(full_path)
            print("stat.st_ctime", stat.st_ctime)
        break
    return dirs


# ['artificial-intelligence', 'data-science'...
def getDirs(folder_path):
    for root, dirs, files in os.walk(folder_path):
        return sorted(dirs)


def getFiles(folder_path):
    for root, dirs, files in os.walk(folder_path):
        return sorted(files)

folder_path = "docs"
files = getFiles(folder_path)

domains = getDirs(folder_path)

domainToMarkdownFiles = {}
domainToSFiles = {} # SFile object
for domain in domains:
    if domain.endswith(".assets") or domain == "misc":
        continue

    domainPath = os.path.join(folder_path, domain)
    sFileList = []
    
    cFiles = getFiles(domainPath)
    for file in cFiles:
        if file.endswith(".md"):
            sFileList.append(SFile(os.path.join(domainPath, file), file, int(os.path.getctime(os.path.join(domainPath, file)))))
    
    subdomains = getDirs(domainPath)
    for subdomain in subdomains:
        subdomainPath = os.path.join(domainPath, subdomain)
        subdomainFiles = getFiles(subdomainPath)
        for subdomainFileName in subdomainFiles:
            if subdomainFileName.endswith(".md"):
                sFileList.append(SFile(os.path.join(subdomainPath, subdomainFileName), subdomainFileName, int(os.path.getctime(os.path.join(subdomainPath, subdomainFileName)))))
    
    domainToSFiles[domain] = sorted(sFileList, key=lambda x: x.filename)
    
# add additional files


domainToc = ""
summary = []
noHeadingOneFiles = []
for domain in domainToSFiles:
    # domain = "artificial-intelligence" -> domaincapitalize = "Artificial Intelligence"
    domaincapitalize = " ".join([word.capitalize() for word in domain.split("-")])
    domainToc += f"## {domaincapitalize}\n"

    idxOfDomain = 1
    for sfile in domainToSFiles[domain]:
        fileName = sfile.filename
        filePath = sfile.path
        
        if sfile.is_additional_file:
            # TODO: add additional files
            continue
        
        if "daily-challenge" in sfile.path:
            continue

        # get the level 1 heading of the markdown file
        header = ""
        with open(sfile.path, "r") as f:
            for line in f:
                if line.startswith("# "):
                    header = line[2:].removesuffix("\n")
                    break
        if header != "":
            # Header: Nextjs Project Dashboard 02 File: frontend/240623-04-nextjs-project-dashboard-02.md
            # print("Header:", header, "File:", file) 

            fileName = fileName.removesuffix(".md")
            cfile = f"[{header}](https://doc.fenglyulin.com/docs/{domain}/{fileName})\n"
            summary.append(cfile)
            domainToc += f"{idxOfDomain}. " + cfile
            # header = file.split("/")[-1]
            idxOfDomain += 1
        else:
            noHeadingOneFiles.append(fileName)
    domainToc += "\n"

# print(domainToc)

allToc = "# å…¨éƒ¨æ–‡ç«  All Articles\n\n"
# summary = sorted(summary)
for i in range(len(summary)):
    allToc += f"{i+1}. {summary[i]}"
    
# print(allToc)
final = summaryPrePart + allToc + domainToc

with open(os.path.join(folder_path, "practise-coding-record.md"), "w") as f:
    f.write(final)

print("Num of headinding Files", len(noHeadingOneFiles), "\nNo Heading One Files:", noHeadingOneFiles)