# Linux系统常见概念 Overview

## 文件权限

文件权限字符串由 10 个字符组成，由 1 bit文件类型和三个权限组组成：

| 字符位置 | 含义               | 示例                         |
| -------- | ------------------ | ---------------------------- |
| 1        | 文件类型           | `d` (目录) 或 `-` (普通文件) |
| 2-4      | 用户（所有者）权限 | `rwx`                        |
| 5-7      | 组权限             | `---`                        |
| 8-10     | 其他用户权限       | `---`                        |

文件类型

- **`d`**：表示目录（directory）。
- **`-`**：表示普通文件（regular file）。
- **`l`**：表示符号链接（symbolic link）。
- **`b`**：表示块设备（block device），如硬盘。
- **`c`**：表示字符设备（character device），如终端或键盘。
- **`s`**：表示套接字（socket）。

权限组

- 一组权限中的 3 位分别为 r、w、x 权限，表示可读、可写、可执行。

- 可以将一组权限用数字来表示， `rwx` 可以表示为 `7`。一组权限的 3 个位当做二进制数字的位，从左到右每个权限的权值为 r : 4、w : 2、x : 1。

实例

`drwx------`，

- **`d`**：表示这是一个**目录**。如果是普通文件，则这个字符会是 `-`。
- **`rwx`**：表示目录所有者（用户）有**读**（`r`）、**写**（`w`）和**执行**（`x`）权限。对于目录，"执行"（`x`）权限表示用户可以进入这个目录。
- **`---`**：表示**组用户**没有任何权限。
- **`---`**：表示**其他用户**没有任何权限。

### chmod 配置权限

change mode

```html
chmod [-R] xyz dirname/filename
```

实例：将 .bashrc 文件的权限修改为 `-rwxr-xr--`，也即 754

- 第一组 `rwx` 为 `4+2+1=7`
- 第二组 `r-x` 为 `4+1=5`
- 第三组 `r--` 为 `4`

```html
chmod 754 .bashrc
```

### 使用符号来配置权限

```html
chmod [ugoa][+-=][rwx] dirname/filename
- u：拥有者
- g：所属群组
- o：其他人
- a：所有人
- +：添加权限
- -：移除权限
- =：设定权限
```

示例：为 .bashrc 文件的所有用户添加写权限。

```html
chmod a+w .bashrc
```

示例：添加执行权限

```
chmod +x install_pytorch_cuda12_1.sh
```

### 默认权限

- 文件默认权限：文件默认没有可执行权限，因此为 666，也就是 -rw-rw-rw- 。
- 目录默认权限：目录必须要能够进入，也就是必须拥有可执行权限，因此为 777 ，也就是 drwxrwxrwx。

可以通过 umask 设置或者查看默认权限，通常以掩码的形式来表示，例如 002 表示其它用户的权限去除了一个 2 的权限，也就是写权限，因此建立新文件时默认的权限为 -rw-rw-r--。

### 目录的权限

文件名不是存储在一个文件的内容中，而是存储在一个文件所在的目录中。因此，拥有文件的 w 权限并不能对文件名进行修改。

目录存储文件列表，一个目录的权限也就是对其文件列表的权限。因此，目录的 r 权限表示可以读取文件列表；w 权限表示可以修改文件列表，具体来说，就是添加删除文件，对文件名进行修改；x 权限可以让该目录成为工作目录，x 权限是 r 和 w 权限的基础，如果不能使一个目录成为工作目录，也就没办法读取文件列表以及对文件列表进行修改了。

##  目录配置

为了使不同 Linux 发行版本的目录结构保持一致性，Filesystem Hierarchy Standard (FHS) 规定了 Linux 的目录结构。最基础的三个目录如下：

- `/`
  - root，根目录
- `/usr`
  - unix software resource，所有系统默认软件都会安装到这个目录；
- `/var`
  -  variable，存放系统或程序运行过程中的数据文件。

![image-20240527132946122](./20241014-linux.assets/image-20240527132946122.png)

## 拓展系统路径 PATH

定义环境变量（如 `export PATH=/my/custom/path:$PATH`）的作用主要是为你的 Singularity 容器设置或修改运行时的系统环境，使其能够正确找到你所需的程序或工具。具体来说：

- **PATH 环境变量**：`PATH` 是一个系统环境变量，定义了操作系统在运行程序时需要搜索的目录列表。当你输入一个命令（例如 `vim` 或 `python`），系统会按照 `PATH` 中定义的目录顺序查找该命令。

- **自定义路径**：通过 `export PATH=/my/custom/path:$PATH`，你将 `/my/custom/path` 这个目录添加到 `PATH` 的最前面。这意味着当你在容器内运行某个命令时，系统会优先在 `/my/custom/path` 中查找对应的可执行文件，而不是在默认的系统目录中。

## 错误输出标准输出

在 Linux 中，程序的输出被分为三种类型：

1. **标准输入** (`stdin`)：文件描述符为 `0`。
2. **标准输出** (`stdout`)：文件描述符为 `1`。
3. **标准错误输出** (`stderr`)：文件描述符为 `2`。

当你运行一个命令时：

- `stdout` 是命令的正常输出。
- `stderr` 是命令的错误输出（例如警告或错误信息）。

可以通过添加 `2>&1` 将标准错误（`stderr`）重定向到标准输出（`stdout`）来解决问题，这样 `grep` 就能处理所有输出，包括潜在的警告信息：

```
module avail 2>&1 | grep python3 #这将同时捕获所有输出，并允许 `grep` 搜索其中包含 `python3` 的行。
```

```
module avail 2>/dev/null #将 **标准错误输出** 重定向到 `/dev/null`，即隐藏标准输出，只显示错误输出。
```

**只看错误输出**

````
module avail 2>&1 >/dev/null | grep python
````

- `2>&1` 将错误输出重定向到标准输出。

- `>/dev/null` 隐藏标准输出，只保留错误输出。`/dev/null` 是一个特殊的“黑洞”设备，任何写入它的内容都会被丢弃。因此，这个命令意味着“丢弃所有的错误输出，只保留标准输出”。

**只看标准输出**

```
module avail 2>/dev/null | grep python
```

## 安装依赖

Debian 系列（如 Ubuntu）：选择 `.deb` 安装包。

- 使用 `dpkg` 安装，与 Debian 系统的包管理器兼容，自动处理依赖关系。

Red Hat 系列（如 CentOS、Fedora）：选择 `.rpm` 安装包。

- 与 RPM 系统的包管理器兼容，自动处理依赖关系。

其他 Linux 发行版：选择 `.run` 安装包。

- 需要手动处理依赖关系。

## debian 包管理

`dpkg` 和 `apt-get` 都是用于在 Debian 系列 Linux 发行版（如 Ubuntu）上管理软件包的工具，但它们有一些重要的区别：

1. **低层次 vs 高层次**：
   - `dpkg` 是一个较低层次的包管理工具，它直接操作 `.deb` 包文件。通过 `dpkg`，可以安装、卸载、查询已安装的包等，但不会自动处理包的依赖关系。
   - `apt-get` 是较高层次的包管理工具，基于 `dpkg`，它负责自动处理依赖关系，并从软件源下载所需的软件包。

2. **依赖管理**：
   - `dpkg` 在安装软件包时不会自动处理依赖关系。例如，如果一个包需要依赖另一个包而它尚未安装，`dpkg` 会报错。
   - `apt-get` 会自动解析并安装依赖。使用 `apt-get install <package>` 可以确保依赖项被一同安装。

3. **用法场景**：
   - `dpkg` 主要用于本地 `.deb` 包的管理，例如 `dpkg -i package.deb` 用于安装 `.deb` 包文件。
   - `apt-get` 用于从软件源（如官方仓库或 PPA）下载和安装包。例如 `apt-get install <package>` 会自动从源下载并安装包。

4. **常见命令对比**：
   - 安装包：
     - `dpkg -i <package.deb>`  (仅限本地 `.deb` 包)
     - `apt-get install <package>` (从源下载并安装)
   - 卸载包：
     - `dpkg -r <package>`
     - `apt-get remove <package>`

5. **缓存管理**：
   - `apt-get` 可以更新软件包列表和清理包缓存，使用 `apt-get update` 和 `apt-get clean` 等命令。
   - `dpkg` 没有相应的功能，因为它不负责包的下载。

简而言之，`dpkg` 更适合手动管理 `.deb` 文件，而 `apt-get` 更适合自动化管理和处理依赖的情境。



**Ubuntu** 和 **Debian** 是两个独立的 Linux 发行版，但 Ubuntu 是基于 Debian 开发的。它们有一些相似性，但也各自有独特的特性。

Debian

1. **Debian** 是一个完全由社区支持的开源 Linux 发行版，最早在 1993 年发布，是最古老且稳定的 Linux 发行版之一。
2. **宗旨**：Debian 以稳定和安全著称，注重开源性和社区贡献，并且坚持软件的自由和开放性。
3. **包管理**：Debian 使用 `.deb` 包格式，并依赖 `dpkg` 和 APT 系统进行软件管理。
4. **软件稳定性**：Debian 的开发周期较长，主要有三个版本：`stable`（稳定版），`testing`（测试版），和 `unstable`（不稳定版）。稳定版在发布前经过长时间的测试，确保软件的稳定性和可靠性，因此广泛应用于服务器和开发环境。

Ubuntu

1. **Ubuntu 基于 Debian**：Ubuntu 是由公司（Canonical）主导开发的发行版，基于 Debian 的 `testing` 分支，为用户提供了一个更易用、更现代化的 Linux 系统。
2. **特点与目标**：Ubuntu 的目标是提供一个对桌面用户更友好和易用的操作系统，因此增加了许多用户界面和硬件支持方面的改进。它每六个月发布一个新版本，并且有长期支持（LTS）版本，每两年发布一次，提供 5 年的安全更新。
3. **区别**：与 Debian 的稳定性取向不同，Ubuntu 更注重创新和桌面用户体验。Ubuntu 的一些软件版本可能较新，但相对稳定性稍弱，因此通常用于桌面环境和个人电脑。

linux 内核与发行版的关系

1. Linus Torvalds 是 **Linux** 内核的创建者，Linux 内核是所有 Linux 发行版的核心部分，包括 Debian 和 Ubuntu。但 Linus 并没有直接开发 Debian、Ubuntu 或任何其他 Linux 发行版。
2. **Linux**：Linus Torvalds 创建的内核，是所有 Linux 发行版的核心。
   1. **Linux 内核** 是基础的引擎；
3. **Debian**：基于 Linux 内核构建的发行版，注重稳定性和开源性。
   1. **Debian** 是基于这个引擎构建的可靠车辆；
4. **Ubuntu**：基于 Debian 开发的发行版，主要面向桌面用户和初学者，增强了用户体验。
   1. **Ubuntu** 是在这个可靠车辆的基础上添加了舒适的座椅和用户界面，使得普通用户驾驶更为方便。

## 架构

- X86_64 
  - 是由 Intel 和 AMD 共同开发的架构，基于复杂指令集计算（CISC，Complex Instruction Set Computing），这意味着它有更丰富的指令集，可以在较少指令下完成更多的任务。
  - 功耗相对较高，但单核性能和多线程处理能力较强，适合需要长时间处理复杂计算任务的场景（如服务器和工作站）。
  - 由于其复杂指令集，x86-64 通常拥有更高的计算性能，适合高负载、多任务的应用。
  - 大量商业软件和专业应用程序对 x86-64 架构进行了优化。
- ARM
  - ARM 使用精简指令集计算（RISC，Reduced Instruction Set Computing），即设计了更少和更简单的指令。这种设计更节省能耗。
  - 由于其精简指令集设计，功耗较低，且散热需求少，非常适合电池供电的移动设备。
  - 虽然 ARM 的单核性能较弱，但近年来 ARM 的设计不断增强，多核 ARM 处理器（如 Apple 的 M1、M2 芯片）性能也在快速提升，已在部分场景中追赶甚至超过了 x86-64。
  - 像 Apple 的 M 系列芯片推出后，更多桌面级应用也开始支持 ARM。

# Reference

1. [Linux](https://www.cyc2018.xyz/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/Linux/Linux.html#grep)
2. 