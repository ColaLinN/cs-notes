## 问题清单

1. Redis是单线程还是多线程？
2. 那为什么 Redis 在 4.0 之前会选择使用单线程？而且使用单线程还那么快？
3. Redis 是如何实现数据不丢失的呢？
4. 讲讲Redis备份持久化的实现原理？
   1. Redis 为什么要先执行命令，再把数据写入日志呢？
   2. 那后写日志又有什么风险呢？
   3. RDB 做快照时会阻塞线程吗？
   4. RDB 做快照的时候数据能修改吗？
   5. Redis 是怎么解决在 bgsave 做快照的时候允许数据修改呢？
5. Redis 如何实现高可用？
6. Redis为什么需要使用集群模式呢？
7. Redis Cluster 在存储的时候如何确定选择哪个节点呢？

## Redis是单线程还是多线程？

在数据操作上是单线程

而在bgsave、网络IO等操作上是多线程的

## 那为什么 Redis 在 4.0 之前会选择使用单线程？而且使用单线程还那么快？

- 无锁，没有共享内存的冲突
- 减少了线程上下文切换的时间
- 纯内存操作，快
- 使用了epoll

## Redis 是如何实现数据不丢失的呢？

有两种备份方式

- AOF（Append Only File）
  - 每执行一次命令添加一行log，可以压缩
  - pros：更新频率高；时效性强
  - cons：文件大；恢复速度慢
- RDS（Redis Database）
  - 二进制文件，即某个时刻Redis的内存拷贝。定期备份
  - pros：更新频率低；时效性差
  - cons：文件小；恢复速度快